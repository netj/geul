#!/usr/bin/env bash
# geul-publish -- publish articles
# Author: Jaeho Shin <netj@sparcs.org>
# Created: 2009-06-04
set -e
. "$GEUL.sh"
. "$GEUL.running-inside-a-repo"

GEUL_BASEURL=`cat "$GEUL_DIR/base-url" 2>/dev/null`
[ -n "$GEUL_BASEURL" ] || error ".geul/base-url: base URL is empty"
export GEUL_BASEURL

products=()
for a; do
    case "$a" in
        *.*) products+=("$a") ;;
    esac
done

{
    echo .htaccess
    (cd "$GEUL_BASE/publish" && find chrome -type f)
    for a in "${products[@]}"; do
        echo "$a"
    done
    geul-ls -a "$@" | sed '
        s/\.geul$/.xhtml/
        s/\.xhtml$/.html/
        '"${GEUL_PATH:+s#^#$GEUL_PATH/#}"'
        '
} |
sed 's#^#'"$GEUL_STAGE"'/#' |
xargs requires SHOW_PROGRESS=true
