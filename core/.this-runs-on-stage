#!/usr/bin/env bash
# .this-runs-on-stage -- setup GEUL_STAGE and GEUL_DIR, GEUL_PATH
# Author: Jaeho Shin <netj@sparcs.org>
# Created: 2009-07-09

if [ -n "$GEUL_STAGE" ]; then
    # if stage is given
    if [ -z "$GEUL_DIR" ]; then
        # complain unless archive is also given
        error "both GEUL_STAGE and GEUL_DIR should be specified"
        false
    fi
else
    # otherwise, assume archive is on the root of the stage directory
    GEUL_STAGE=`find-stage`
    GEUL_DIR="$GEUL_STAGE/.geul"
fi
export GEUL_DIR GEUL_STAGE

# compute relative path
GEUL_PATH=${PWD#$GEUL_STAGE}
GEUL_PATH=${GEUL_PATH#/}
GEUL_PATH=${GEUL_PATH%/}
export GEUL_PATH
